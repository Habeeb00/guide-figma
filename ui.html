<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>
      body {
        font-family: sans-serif;
        margin: 16px;
        font-size: 12px;
      }
      h1 {
        font-size: 14px;
        margin: 0 0 16px 0;
      }
      .error {
        color: #d73a49;
        background: #ffeaea;
        padding: 8px;
        border-radius: 4px;
      }
      .results {
        background: #f8f9fa;
        padding: 8px;
        border-radius: 4px;
      }
      .guide {
        margin: 4px 0;
        font-weight: 600;
        color: #0d99ff;
        display: flex;
        justify-content: space-between;
      }
      .del {
        background: #ff4444;
        color: white;
        border: none;
        border-radius: 3px;
        padding: 2px 6px;
        cursor: pointer;
        font-size: 10px;
      }
      .clear-btn {
        background: #ff6666;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 6px 12px;
        cursor: pointer;
        font-size: 11px;
        margin-top: 8px;
        width: 100%;
      }
      .add-section {
        background: #e8f5e9;
        padding: 12px;
        border-radius: 4px;
        margin-bottom: 16px;
      }
      .add-form {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-bottom: 8px;
      }
      select,
      input {
        padding: 4px;
        border: 1px solid #ccc;
        border-radius: 3px;
        font-size: 11px;
      }
      .add-btn {
        background: #28a745;
        color: white;
        border: none;
        border-radius: 3px;
        padding: 4px 8px;
        cursor: pointer;
        font-size: 11px;
      }
      .copy-paste-btns {
        display: flex;
        gap: 4px;
        margin-top: 8px;
      }
      .copy-btn {
        background: #007bff;
        color: white;
        border: none;
        border-radius: 3px;
        padding: 4px 8px;
        cursor: pointer;
        font-size: 11px;
        flex: 1;
      }
      .paste-btn {
        background: #6c757d;
        color: white;
        border: none;
        border-radius: 3px;
        padding: 4px 8px;
        cursor: pointer;
        font-size: 11px;
        flex: 1;
      }
      .copy-dialog {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border: 2px solid #007bff;
        border-radius: 8px;
        padding: 16px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        display: none;
      }
      .dialog-btn {
        margin: 4px;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 11px;
        min-width: 80px;
      }
      .dialog-btn.primary {
        background: #007bff;
        color: white;
      }
      .dialog-btn.secondary {
        background: #6c757d;
        color: white;
      }
      .toggle-btn {
        background: #17a2b8;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 6px 12px;
        cursor: pointer;
        font-size: 11px;
        margin-top: 8px;
        width: 100%;
      }
      .eye-icon {
        margin-right: 4px;
        font-size: 12px;
      }
    </style>
  </head>
  <body>
    <h1>Frame Guides</h1>

    <div class="add-section">
      <div class="add-form">
        <select id="axis">
          <option value="Y">Horizontal</option>
          <option value="X">Vertical</option>
        </select>
        <input type="text" id="position" placeholder="100px or 50%" />
        <button class="add-btn" onclick="addGuide()">Add</button>
      </div>
    </div>

    <div id="results">Select a frame...</div>

    <div id="copyDialog" class="copy-dialog">
      <div style="margin-bottom: 12px; font-weight: 600">Copy Guides</div>
      <div style="margin-bottom: 12px; font-size: 11px; color: #666">
        Choose how to copy the guides:
      </div>
      <div>
        <button class="dialog-btn primary" onclick="copyGuidesByType('px')">
          Copy by Pixels
        </button>
        <button class="dialog-btn primary" onclick="copyGuidesByType('%')">
          Copy by Percentage
        </button>
      </div>
      <div style="margin-top: 8px">
        <button class="dialog-btn secondary" onclick="closeCopyDialog()">
          Cancel
        </button>
      </div>
    </div>
    <script>
      onmessage = (e) => {
        if (e.data.pluginMessage.type === "guides-result") {
          const data = e.data.pluginMessage.data;
          const div = document.getElementById("results");

          if (data.error) {
            div.innerHTML = `<div class="error">${data.error}</div>`;
          } else {
            const eyeIcon = data.guidesVisible ? "️  " : "🙈";
            const guides = data.guides.length
              ? data.guides
                  .map(
                    (g, i) =>
                      `<div class="guide"><span><span class="eye-icon">${eyeIcon}</span>${
                        g.axis === "X" ? "Vertical" : "Horizontal"
                      } at ${parseFloat(g.offset).toFixed(
                        2
                      )}px</span><button class="del" onclick="deleteGuide(${i})">×</button></div>`
                  )
                  .join("")
              : "<div>No guides</div>";
            const toggleText = data.guidesVisible
              ? "Hide Guides in UI"
              : "Show Guides in UI";
            div.innerHTML = `<div class="results"><strong>${data.frameName}</strong> (${data.guidesCount})<br>${guides}<br><button class="clear-btn" onclick="clearAllGuides()">Clear All Guides</button><button class="toggle-btn" onclick="toggleGuides()">${toggleText}</button><div class="copy-paste-btns"><button class="copy-btn" onclick="copyGuides()">Copy Guides</button><button class="paste-btn" onclick="pasteGuides()">Paste Guides</button></div></div>`;
          }
        }

        if (
          e.data.pluginMessage.type === "copy-status" ||
          e.data.pluginMessage.type === "paste-status"
        ) {
          // Show brief status message
          const statusDiv = document.createElement("div");
          statusDiv.style.cssText =
            "position:fixed;top:10px;right:10px;background:#333;color:white;padding:8px;border-radius:4px;font-size:11px;z-index:1000;";
          statusDiv.textContent = e.data.pluginMessage.data.message;
          document.body.appendChild(statusDiv);
          setTimeout(() => document.body.removeChild(statusDiv), 2000);
        }
      };

      function deleteGuide(index) {
        parent.postMessage(
          { pluginMessage: { type: "delete-guide", index } },
          "*"
        );
      }

      function clearAllGuides() {
        parent.postMessage(
          { pluginMessage: { type: "clear-all-guides" } },
          "*"
        );
      }

      function addGuide() {
        const axis = document.getElementById("axis").value;
        const position = document.getElementById("position").value.trim();

        if (!position) {
          alert("Please enter a position (e.g., 100px or 50%)");
          return;
        }

        parent.postMessage(
          { pluginMessage: { type: "add-guide", axis, position } },
          "*"
        );

        // Clear input after adding
        document.getElementById("position").value = "";
      }

      function copyGuides() {
        document.getElementById("copyDialog").style.display = "block";
      }

      function closeCopyDialog() {
        document.getElementById("copyDialog").style.display = "none";
      }

      function copyGuidesByType(type) {
        parent.postMessage(
          { pluginMessage: { type: "copy-guides", copyType: type } },
          "*"
        );
        closeCopyDialog();
      }

      function pasteGuides() {
        parent.postMessage({ pluginMessage: { type: "paste-guides" } }, "*");
      }

      function toggleGuides() {
        parent.postMessage({ pluginMessage: { type: "toggle-guides" } }, "*");
      }
    </script>
  </body>
</html>
